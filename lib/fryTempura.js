"use strict";var p=class extends Error{constructor(t,r=`Unsupported type: ${t}`){super(r)}};var L=e=>({ch:e.col,line:e.line}),a=()=>app.workspace.getActiveFile();function M(){let e=a();return e?app.metadataCache.getFileCache(e):null}var u=()=>M()?.frontmatter??null,y=()=>M()?.sections?.filter(e=>e.type==="code")??[],i=()=>app.workspace.activeEditor?.editor??null,s=()=>app.workspace.activeEditor.metadataEditor??null;function d(){let e=i();return e?e.getLine(e.getCursor().line):null}function k(){let e=a();return e?app.metadataCache.getBacklinksForFile(e).data:null}function m(){let e=i();return e?e.getSelection():null}function C(e){let t=i();return t?e?t.getRange(L(e.start),L(e.end)):t.getValue():null}function f(e){let t=i();t&&t.replaceSelection(e)}function P(){let e=i();if(!e)return;let t=e.getCursor();t.line===e.lastLine()?e.setLine(t.line,""):e.replaceRange("",{line:t.line,ch:0},{line:t.line+1,ch:0})}function T(e,t){let r=i();if(!r)return;let{line:n,ch:o}=r.getCursor();r.setLine(n,e);let c=t?.cursor==="last"?e.length:Math.min(o,e.length-1);r.setCursor({line:n,ch:c})}function E(e,t){new Notice(e,t??null)}function l(e){return moment(e)}function S(){return app.plugins.plugins["templater-obsidian"].templater.current_functions_object}function re(e,t="asc"){return(r,n)=>t==="asc"?e(r)>e(n)?1:e(n)>e(r)?-1:0:e(r)<e(n)?1:e(n)<e(r)?-1:0}function U(e,t,r="asc"){return e.slice().sort(re(t,r))}function $(e){let t=Array.from(e.matchAll(/^(?<prefix>[ \t\s]*([-*] (\[.] |)|))(?<content>.*)$/g)).at(0);return{prefix:t?.groups?.prefix??"",content:t?.groups?.content??""}}function w(e){return e.split(" ").filter(t=>t.startsWith("#")).map(t=>t.slice(1))}function B(e){return e.replaceAll(/\*\*([^*]*?)\*\*/g,"$1").replaceAll(/__([^*]*?)__/g,"$1").replaceAll(/\*([^*]*?)\*/g,"$1").replaceAll(/_([^*]*?)_/g,"$1").replaceAll(/~~([^~]*?)~~/g,"$1").replaceAll(/==([^~]*?)==/g,"$1")}function b(e){return e.replaceAll(/\[\[[^\|\]]*?\|([^\]]*?)\]\]/g,"$1").replaceAll(/\[\[([^\]]*?)\]\]/g,"$1").replaceAll(/\[([^\]]*?)\]\(.*?\)/g,"$1").replaceAll(/\[([^\]]*?)\]/g,"$1")}function D(){return{editor:i(),properties:u(),metadataEditor:s()}}function h(e,t){let r=s();r&&r.insertProperties({[e]:t})}function I(e){let t=s();t&&t.insertProperties(e)}function _(e,t){x(e),h(e,t)}function x(e){let t=s();t&&t.insertProperties({[e]:null})}function j(){return u()?.tags??[]}function V(e){let t=s();t&&t.focusValue(e)}function R(){return u()?.aliases??[]}async function N(e){let t=i();t&&t.replaceRange(e,t.getCursor())}function v(){return d()}function W(){return P()}function q(){let e=v();return e?w(e):[]}function A(){return i()?.getSelection()?.split(`
`)??null}function z(){return y().map(e=>{let t=C(e.position);return{language:t.match(/[`~]{3,}(?<language>[^ \n]*)/)?.groups?.language||null,content:t.split(`
`).slice(1).slice(0,-1).join(`
`),position:e.position}})}function F(e){i()?.replaceSelection(e)}function G(e,t){let r=d(),{prefix:n,content:o}=$(r),c=t?.attached??"prefix",g;switch(c){case"prefix":g=`${n}${e}${o}`;break;case"suffix":g=`${n}${o}${e}`;break;default:throw new p(c)}T(g,{cursor:t?.cursor})}function H(e){let t=e?.order??"asc",r=e?.predicate??(c=>c),n=A();if(!n)return;let o=U(n,r,t);F(o.join(`
`))}function J(){let e=m();if(!e)return;let t=B(e);f(t)}function K(){let e=m();if(!e)return;let t=b(e);f(t)}function Q(e,t=5e3){E(e,t==="never"?void 0:t)}function X(){return Object.keys(k()??{})}function Y(e){let t=a();if(!t)return null;let r=t.stat.ctime;switch(e){case"unixtime":return r;case"moment":return l(r);default:return l(r).format(e)}}function Z(e){let t=a();if(!t)return null;let r=t.stat.mtime;switch(e){case"unixtime":return r;case"moment":return l(r);default:return l(r).format(e)}}function O(e){let t=l();switch(e){case"unixtime":return t.unix();case"moment":return t;default:return t.format(e)}}function ee(e){return S().system.prompt(e)}module.exports=()=>({use:D,insert:N,addProperty:h,addProperties:I,removeProperty:x,updateProperty:_,focusPropertyValue:V,getActiveLine:v,getActiveLineTags:q,getBacklinkPaths:X,getCreationDate:Y,getUpdateDate:Z,getSelectionLines:A,setTextToSelection:F,attachTextToListItem:G,sortSelectionLines:H,readTagsFromProperty:j,readAliasesFromProperty:R,deleteActiveLine:W,stripDecorationFromSelection:J,stripLinksFromSelection:K,notify:Q,now:O,showInputDialog:ee,getCodeBlocks:z});
