"use strict";var p=class extends Error{constructor(t,r=`Unsupported type: ${t}`){super(r)}};var l=()=>app.workspace.getActiveFile();function K(){let e=l();return e?app.metadataCache.getFileCache(e):null}var u=()=>K()?.frontmatter??null,i=()=>app.workspace.activeEditor?.editor??null,a=()=>app.workspace.activeEditor.metadataEditor??null;function d(){let e=i();return e?e.getLine(e.getCursor().line):null}function M(){let e=l();return e?app.metadataCache.getBacklinksForFile(e).data:null}function m(){let e=i();return e?e.getSelection():null}function f(e){let t=i();t&&t.replaceSelection(e)}function L(){let e=i();if(!e)return;let t=e.getCursor();t.line===e.lastLine()?e.setLine(t.line,""):e.replaceRange("",{line:t.line,ch:0},{line:t.line+1,ch:0})}function y(e,t){let r=i();if(!r)return;let{line:n,ch:o}=r.getCursor();r.setLine(n,e);let c=t?.cursor==="last"?e.length:Math.min(o,e.length-1);r.setCursor({line:n,ch:c})}function E(e,t){new Notice(e,t??null)}function s(e){return moment(e)}function X(e,t="asc"){return(r,n)=>t==="asc"?e(r)>e(n)?1:e(n)>e(r)?-1:0:e(r)<e(n)?1:e(n)<e(r)?-1:0}function k(e,t,r="asc"){return e.slice().sort(X(t,r))}function T(e){let t=Array.from(e.matchAll(/^(?<prefix>[ \t\s]*([-*] (\[.] |)|))(?<content>.*)$/g)).at(0);return{prefix:t?.groups?.prefix??"",content:t?.groups?.content??""}}function P(e){return e.split(" ").filter(t=>t.startsWith("#")).map(t=>t.slice(1))}function S(e){return e.replaceAll(/\*\*([^*]*?)\*\*/g,"$1").replaceAll(/__([^*]*?)__/g,"$1").replaceAll(/\*([^*]*?)\*/g,"$1").replaceAll(/_([^*]*?)_/g,"$1").replaceAll(/~~([^~]*?)~~/g,"$1").replaceAll(/==([^~]*?)==/g,"$1")}function C(e){return e.replaceAll(/\[\[[^\|\]]*?\|([^\]]*?)\]\]/g,"$1").replaceAll(/\[\[([^\]]*?)\]\]/g,"$1").replaceAll(/\[([^\]]*?)\]\(.*?\)/g,"$1").replaceAll(/\[([^\]]*?)\]/g,"$1")}function U(){return{editor:i(),properties:u(),metadataEditor:a()}}function h(e,t){let r=a();r&&r.insertProperties({[e]:t})}function $(e){let t=a();t&&t.insertProperties(e)}function w(e,t){x(e),h(e,t)}function x(e){let t=a();t&&t.insertProperties({[e]:null})}function D(){return u()?.tags??[]}function b(e){let t=a();t&&t.focusValue(e)}function B(){return u()?.aliases??[]}async function I(e){let t=i();t&&t.replaceRange(e,t.getCursor())}function v(){return d()}function _(){return L()}function V(){let e=v();return e?P(e):[]}function A(){return i()?.getSelection()?.split(`
`)??null}function F(e){i()?.replaceSelection(e)}function j(e,t){let r=d(),{prefix:n,content:o}=T(r),c=t?.attached??"prefix",g;switch(c){case"prefix":g=`${n}${e}${o}`;break;case"suffix":g=`${n}${o}${e}`;break;default:throw new p(c)}y(g,{cursor:t?.cursor})}function N(e){let t=e?.order??"asc",r=e?.predicate??(c=>c),n=A();if(!n)return;let o=k(n,r,t);F(o.join(`
`))}function R(){let e=m();if(!e)return;let t=S(e);f(t)}function W(){let e=m();if(!e)return;let t=C(e);f(t)}function q(e,t=5e3){E(e,t==="never"?void 0:t)}function z(){return Object.keys(M()??{})}function G(e){let t=l();if(!t)return null;let r=t.stat.ctime;switch(e){case"unixtime":return r;case"moment":return s(r);default:return s(r).format(e)}}function H(e){let t=l();if(!t)return null;let r=t.stat.mtime;switch(e){case"unixtime":return r;case"moment":return s(r);default:return s(r).format(e)}}function J(e){let t=s();switch(e){case"unixtime":return t.unix();case"moment":return t;default:return t.format(e)}}module.exports=()=>({use:U,insert:I,addProperty:h,addProperties:$,removeProperty:x,updateProperty:w,focusPropertyValue:b,getActiveLine:v,getActiveLineTags:V,getBacklinkPaths:z,getCreationDate:G,getUpdateDate:H,getSelectionLines:A,setTextToSelection:F,attachTextToListItem:j,sortSelectionLines:N,readTagsFromProperty:D,readAliasesFromProperty:B,deleteActiveLine:_,stripDecorationFromSelection:R,stripLinksFromSelection:W,notify:q,now:J});
