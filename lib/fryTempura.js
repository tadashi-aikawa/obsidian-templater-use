"use strict";var u=class extends Error{constructor(t,n=`Unsupported type: ${t}`){super(n)}};var P=e=>({ch:e.col,line:e.line}),l=()=>app.workspace.getActiveFile();function ae(){let e=l();return e?app.metadataCache.getFileCache(e):null}function p(e){let t=app.vault.getAbstractFileByPath(e);return t||null}function ue(e){let t=p(e);return t?app.metadataCache.getFileCache(t):null}var g=()=>ae()?.frontmatter??null,L=e=>ue(e)?.sections?.filter(t=>t.type==="code")??[],i=()=>app.workspace.activeEditor?.editor??null,a=()=>app.workspace.activeEditor.metadataEditor??null;function f(){let e=i();return e?e.getLine(e.getCursor().line):null}function k(){let e=l();return e?app.metadataCache.getBacklinksForFile(e).data:null}function m(){let e=i();return e?e.getSelection():null}async function h(e,t){let n=p(e);if(!n)return null;let r=await app.vault.cachedRead(n);return t?r.slice(t.start.offset,t.end.offset):r}function T(e){let t=i();return t?e?t.getRange(P(e.start),P(e.end)):t.getValue():null}function x(e){let t=i();t&&t.replaceSelection(e)}function E(){let e=i();if(!e)return;let t=e.getCursor();t.line===e.lastLine()?e.setLine(t.line,""):e.replaceRange("",{line:t.line,ch:0},{line:t.line+1,ch:0})}function S(e,t){let n=i();if(!n)return;let{line:r,ch:o}=n.getCursor();n.setLine(r,e);let c=t?.cursor==="last"?e.length:Math.min(o,e.length-1);n.setCursor({line:r,ch:c})}function w(e,t){new Notice(e,t??null)}function s(e){return moment(e)}function b(){return app.plugins.plugins["templater-obsidian"].templater.current_functions_object}function B(){return app.plugins.plugins["periodic-notes"]}function ge(e,t="asc"){return(n,r)=>t==="asc"?e(n)>e(r)?1:e(r)>e(n)?-1:0:e(n)<e(r)?1:e(r)<e(n)?-1:0}function U(e,t,n="asc"){return e.slice().sort(ge(t,n))}function D(e){let t=Array.from(e.matchAll(/^(?<prefix>[ \t\s]*([-*] (\[.] |)|))(?<content>.*)$/g)).at(0);return{prefix:t?.groups?.prefix??"",content:t?.groups?.content??""}}function $(e){return e.split(" ").filter(t=>t.startsWith("#")).map(t=>t.slice(1))}function I(e){return e.replaceAll(/\*\*([^*]*?)\*\*/g,"$1").replaceAll(/__([^*]*?)__/g,"$1").replaceAll(/\*([^*]*?)\*/g,"$1").replaceAll(/_([^*]*?)_/g,"$1").replaceAll(/~~([^~]*?)~~/g,"$1").replaceAll(/==([^~]*?)==/g,"$1")}function _(e){return e.replaceAll(/\[\[[^\|\]]*?\|([^\]]*?)\]\]/g,"$1").replaceAll(/\[\[([^\]]*?)\]\]/g,"$1").replaceAll(/\[([^\]]*?)\]\(.*?\)/g,"$1").replaceAll(/\[([^\]]*?)\]/g,"$1")}function N(e,t){let n=[],r=moment(e).startOf("day"),o=moment(t).startOf("day");if(r.isAfter(o))throw new Error("beginDate is after endDate");for(;n.push(r.clone()),!(r.add(1,"days").diff(o)>0););return n}function R(e){return e!=null}function j(){return{editor:i(),properties:g(),metadataEditor:a()}}function v(e,t){let n=a();n&&n.insertProperties({[e]:t})}function V(e){let t=a();t&&t.insertProperties(e)}function Y(e,t){F(e),v(e,t)}function F(e){let t=a();t&&t.insertProperties({[e]:null})}function W(){return g()?.tags??[]}function q(){return g()?.aliases??[]}function z(e){let t=a();t&&t.focusValue(e)}async function G(e){let t=i();t&&t.replaceRange(e,t.getCursor())}function A(){return f()}function H(){return E()}function J(){let e=A();return e?$(e):[]}function y(){return i()?.getSelection()?.split(`
`)??null}function M(e){i()?.replaceSelection(e)}async function K(){let e=l()?.path;return e?C(e):[]}async function C(e){let t=L(e),n=[];for(let r of t){let o=await h(e,r.position),c=o.match(/[`~]{3,}(?<language>[^ \n]*)/)?.groups?.language||null;n.push({language:c,content:o.split(`
`).slice(1).slice(0,-1).join(`
`),position:r.position})}return n}function Q(e,t){let n=f(),{prefix:r,content:o}=D(n),c=t?.attached??"prefix",d;switch(c){case"prefix":d=`${r}${e}${o}`;break;case"suffix":d=`${r}${o}${e}`;break;default:throw new u(c)}S(d,{cursor:t?.cursor})}function X(e){let t=e?.order??"asc",n=e?.predicate??(c=>c),r=y();if(!r)return;let o=U(r,n,t);M(o.join(`
`))}function Z(){let e=m();if(!e)return;let t=I(e);x(t)}function O(){let e=m();if(!e)return;let t=_(e);x(t)}function ee(e,t=5e3){w(e,t==="never"?void 0:t)}function te(){return Object.keys(k()??{})}function ne(e){let t=l();if(!t)return null;let n=t.stat.ctime;switch(e){case"unixtime":return n;case"moment":return s(n);default:return s(n).format(e)}}function re(e){let t=l();if(!t)return null;let n=t.stat.mtime;switch(e){case"unixtime":return n;case"moment":return s(n);default:return s(n).format(e)}}function oe(e){let t=s();switch(e){case"unixtime":return t.unix();case"moment":return t;default:return t.format(e)}}function ie(e){return b().system.prompt(e)}function ce(e,t){let n=B()?.settings.daily;if(!n)throw new Error("Periodic Notes plugin is not installed.");return N(s(e),s(t)).map(r=>p(`${n.folder}/${r.format(n.format||"YYYY-MM-DD")}.md`)).filter(R)}async function se(e,t){let n=await h(e,t);if(n==null)throw new Error(`${e} is not existed.`);return n}function le(e){let t=T(e);if(t==null)throw new Error("Couldn't get content from the active file.");return t}module.exports=()=>({use:j,insert:G,addProperty:v,addProperties:V,removeProperty:F,updateProperty:Y,focusPropertyValue:z,getActiveLine:A,getActiveLineTags:J,getBacklinkPaths:te,getCreationDate:ne,getUpdateDate:re,getSelectionLines:y,setTextToSelection:M,attachTextToListItem:Q,sortSelectionLines:X,readTagsFromProperty:W,readAliasesFromProperty:q,deleteActiveLine:H,stripDecorationFromSelection:Z,stripLinksFromSelection:O,notify:ee,now:oe,showInputDialog:ie,getCodeBlocks:K,getCodeBlocksFrom:C,getDailyNotes:ce,getFileContent:se,getActiveFileContent:le});
